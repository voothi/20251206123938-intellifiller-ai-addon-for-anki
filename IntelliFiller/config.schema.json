{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "apiKey": {
      "type": "string",
      "description": "API key to access OpenAI GPT API."
    },
    "anthropicKey": {
      "type": "string",
      "description": "API key to access Anthropic Claude API."
    },
    "geminiKey": {
      "type": "string",
      "description": "API key to access Google Gemini API."
    },
    "selectedApi": {
      "type": "string",
      "enum": [
        "openai",
        "anthropic",
        "gemini"
      ],
      "description": "Which API to use"
    },
    "emulate": {
      "type": "string",
      "enum": [
        "yes",
        "no"
      ],
      "description": "Setting to enable or disable emulation mode."
    },
    "overwriteField": {
      "type": "boolean",
      "description": "If true, overwrite the target field. If false, append to it."
    },
    "flatMenu": {
      "type": "boolean",
      "description": "If true, show items directly in the root context menu.",
      "default": false
    },
    "prompts": {
      "type": "array",
      "description": "Array of prompt configurations.",
      "items": {
        "type": "object",
        "properties": {
          "prompt": {
            "type": "string",
            "description": "Template of the prompt to be sent to the GPT API. You can use field names in a form {{{FIELD_NAME}}}. Such placeholders will be replaced to the content of the corresponding fields."
          },
          "targetField": {
            "type": "string",
            "description": "Field name where the GPT response should be stored."
          },
          "responseFormat": {
            "type": "string",
            "enum": [
              "text",
              "json"
            ],
            "default": "text",
            "description": "Format of the response expected from the LLM."
          },
          "fieldMapping": {
            "type": "object",
            "description": "Mapping of JSON keys to Anki fields (used when responseFormat is json).",
            "additionalProperties": {
              "type": "string"
            }
          },
          "promptName": {
            "type": "string",
            "description": "Name for this prompt configuration."
          },
          "pinned": {
            "type": "boolean",
            "description": "If true, this prompt will be pinned to the top level context menu."
          }
        },
        "required": [
          "prompt",
          "targetField",
          "promptName"
        ]
      }
    },
    "pipelines": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "pipelineName": {
            "type": "string"
          },
          "prompts": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "pinned": {
            "type": "boolean",
            "description": "If true, this pipeline will be pinned to the top level context menu."
          }
        },
        "required": [
          "pipelineName",
          "prompts"
        ]
      }
    },
    "maxFavorites": {
      "type": "integer",
      "description": "Maximum number of favorite/history items to show in the context menu.",
      "default": 3
    },
    "history": {
      "type": "array",
      "description": "List of names of recently used prompts.",
      "items": {
        "type": "string"
      },
      "default": []
    }
  },
  "required": [
    "apiKey",
    "anthropicKey",
    "geminiKey",
    "selectedApi",
    "emulate",
    "prompts"
  ],
  "description": "Schema for the configuration of Anki AI Add-on."
}