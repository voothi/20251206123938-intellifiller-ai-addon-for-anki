{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "apiKey": {
      "type": "string",
      "description": "API key to access OpenAI GPT API."
    },
    "anthropicKey": {
      "type": "string",
      "description": "API key to access Anthropic Claude API."
    },
    "geminiKey": {
      "type": "string",
      "description": "API key to access Google Gemini API."
    },
    "openrouterKey": {
      "type": "string",
      "description": "API key to access OpenRouter API."
    },
    "customUrl": {
      "type": "string",
      "description": "Base URL for Custom OpenAI-compatible provider."
    },
    "customKey": {
      "type": "string",
      "description": "API Key for Custom provider."
    },
    "openaiModel": {
      "type": "string"
    },
    "anthropicModel": {
      "type": "string"
    },
    "geminiModel": {
      "type": "string"
    },
    "openrouterModel": {
      "type": "string"
    },
    "customModel": {
      "type": "string"
    },
    "selectedApi": {
      "type": "string",
      "enum": [
        "openai",
        "anthropic",
        "gemini",
        "openrouter",
        "custom"
      ],
      "description": "Which API to use"
    },
    "emulate": {
      "type": "string",
      "enum": [
        "yes",
        "no"
      ],
      "description": "Setting to enable or disable emulation mode."
    },
    "overwriteField": {
      "type": "boolean",
      "description": "If true, overwrite the target field. If false, append to it."
    },
    "flatMenu": {
      "type": "boolean",
      "description": "If true, show items directly in the root context menu.",
      "default": false
    },
    "obfuscateCreds": {
      "type": "boolean",
      "default": true,
      "description": "If true, obfuscate the credentials.json file."
    },
    "encryptionKey": {
      "type": "string",
      "description": "Custom salt for credentials encryption."
    },
    "batchProcessing": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable batch processing logic."
        },
        "batchSize": {
          "type": "integer",
          "default": 20,
          "description": "Number of notes to process before pausing."
        },
        "batchDelay": {
          "type": "integer",
          "default": 10,
          "description": "Seconds to wait between batches."
        }
      }
    },
    "backup": {
      "type": "object",
      "description": "Configuration for periodic backups.",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable periodic backups."
        },
        "localPath": {
          "type": "string",
          "description": "Local directory to store backups."
        },
        "externalPath": {
          "type": "string",
          "description": "Optional secondary directory to copy backups (e.g. Google Drive)."
        },
        "zipPassword": {
          "type": "string",
          "description": "Password for the backup archive."
        },
        "intervalMinutes": {
          "type": "integer",
          "default": 10,
          "description": "Backup check interval in minutes."
        },
        "backupOnSettingsOpen": {
          "type": "boolean",
          "default": true
        },
        "keepTenMin": {
          "type": "integer",
          "default": 6,
          "description": "Number of 10-minute interval backups to keep (covering last hour)."
        },
        "keepHourly": {
          "type": "integer",
          "default": 24,
          "description": "Number of hourly backups to keep (covering last day)."
        },
        "keepDaily": {
          "type": "integer",
          "default": 30,
          "description": "Number of daily backups to keep (covering last month)."
        },
        "keepMonthly": {
          "type": "integer",
          "default": 12,
          "description": "Number of monthly backups to keep (covering last year)."
        },
        "keepYearly": {
          "type": "integer",
          "default": 5,
          "description": "Number of yearly backups to keep."
        }
      }
    },
    "prompts": {
      "type": "array",
      "description": "Array of prompt configurations.",
      "items": {
        "type": "object",
        "properties": {
          "prompt": {
            "type": "string",
            "description": "Template of the prompt to be sent to the GPT API. You can use field names in a form {{{FIELD_NAME}}}. Such placeholders will be replaced to the content of the corresponding fields."
          },
          "targetField": {
            "type": "string",
            "description": "Field name where the GPT response should be stored."
          },
          "responseFormat": {
            "type": "string",
            "enum": [
              "text",
              "json"
            ],
            "default": "text",
            "description": "Format of the response expected from the LLM."
          },
          "fieldMapping": {
            "type": "object",
            "description": "Mapping of JSON keys to Anki fields (used when responseFormat is json).",
            "additionalProperties": {
              "type": "string"
            }
          },
          "promptName": {
            "type": "string",
            "description": "Name for this prompt configuration."
          },
          "pinned": {
            "type": "boolean",
            "description": "If true, this prompt will be pinned to the top level context menu."
          }
        },
        "required": [
          "prompt",
          "targetField",
          "promptName"
        ]
      }
    },
    "pipelines": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "pipelineName": {
            "type": "string"
          },
          "prompts": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "pinned": {
            "type": "boolean",
            "description": "If true, this pipeline will be pinned to the top level context menu."
          }
        },
        "required": [
          "pipelineName",
          "prompts"
        ]
      }
    },
    "maxFavorites": {
      "type": "integer",
      "description": "Maximum number of favorite/history items to show in the context menu.",
      "default": 3
    },
    "history": {
      "type": "array",
      "description": "List of names of recently used prompts.",
      "items": {
        "type": "string"
      },
      "default": []
    }
  },
  "required": [
    "apiKey",
    "anthropicKey",
    "geminiKey",
    "selectedApi",
    "emulate",
    "prompts"
  ],
  "description": "Schema for the configuration of Anki AI Add-on."
}